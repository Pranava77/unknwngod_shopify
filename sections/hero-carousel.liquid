{{ 'hero-carousel.css' | asset_url | stylesheet_tag }}

<div class="hero-carousel-section section-{{ section.id }}-padding">
  <div class="hero-carousel" id="heroCarousel">
    {%- for block in section.blocks -%}
      <div class="hero-slide{% if forloop.first %} active{% endif %}" {{ block.shopify_attributes }}>
        {%- if block.settings.image != blank -%}
          <img
            srcset="{%- if block.settings.image.width >= 375 -%}{{ block.settings.image | image_url: width: 375 }} 375w,{%- endif -%}
              {%- if block.settings.image.width >= 750 -%}{{ block.settings.image | image_url: width: 750 }} 750w,{%- endif -%}
              {%- if block.settings.image.width >= 1100 -%}{{ block.settings.image | image_url: width: 1100 }} 1100w,{%- endif -%}
              {%- if block.settings.image.width >= 1500 -%}{{ block.settings.image | image_url: width: 1500 }} 1500w,{%- endif -%}
              {%- if block.settings.image.width >= 1780 -%}{{ block.settings.image | image_url: width: 1780 }} 1780w,{%- endif -%}
              {%- if block.settings.image.width >= 2000 -%}{{ block.settings.image | image_url: width: 2000 }} 2000w,{%- endif -%}
              {%- if block.settings.image.width >= 3000 -%}{{ block.settings.image | image_url: width: 3000 }} 3000w,{%- endif -%}
              {{ block.settings.image | image_url }} {{ block.settings.image.width }}w"
            sizes="100vw"
            src="{{ block.settings.image | image_url: width: 1500 }}"
            loading="lazy"
            alt="{{ block.settings.image.alt | escape }}"
            width="{{ block.settings.image.width }}"
            height="{{ block.settings.image.height }}"
            class="hero-image"
          >
        {%- else -%}
          {{ 'lifestyle-2' | placeholder_svg_tag: 'placeholder-svg' }}
        {%- endif -%}
        
        <div class="hero-content-container {% if block.settings.content_position %}content-{{ block.settings.content_position }}{% endif %}">
          <div class="hero-content">
            {%- if block.settings.heading != blank -%}
              <h2 class="hero-heading">{{ block.settings.heading | escape }}</h2>
            {%- endif -%}
            {%- if block.settings.text != blank -%}
              <div class="hero-text">{{ block.settings.text }}</div>
            {%- endif -%}
            {%- if block.settings.button_label != blank and block.settings.button_link != blank -%}
              <a href="{{ block.settings.button_link }}" class="button">
                {{ block.settings.button_label | escape }}
              </a>
            {%- endif -%}
          </div>
        </div>
      </div>
    {%- endfor -%}
    
    <div class="carousel-controls">
      <button class="carousel-control prev" aria-label="Previous slide">‹</button>
      <div class="carousel-indicators">
        {%- for block in section.blocks -%}
          <button class="carousel-indicator{% if forloop.first %} active{% endif %}" 
                  aria-label="Go to slide {{ forloop.index }}"
                  data-slide="{{ forloop.index0 }}"></button>
        {%- endfor -%}
      </div>
      <button class="carousel-control next" aria-label="Next slide">›</button>
    </div>
  </div>
</div>

<script>
  class HeroCarousel {
    constructor() {
      this.carousel = document.getElementById('heroCarousel');
      this.slides = this.carousel.querySelectorAll('.hero-slide');
      this.indicators = this.carousel.querySelectorAll('.carousel-indicator');
      this.prevButton = this.carousel.querySelector('.prev');
      this.nextButton = this.carousel.querySelector('.next');
      this.currentSlide = 0;
      this.slideInterval = null;
      
      this.init();
    }
    
    init() {
      this.bindEvents();
      this.startAutoSlide();
    }
    
    bindEvents() {
      this.prevButton.addEventListener('click', () => this.prevSlide());
      this.nextButton.addEventListener('click', () => this.nextSlide());
      
      this.indicators.forEach((indicator, index) => {
        indicator.addEventListener('click', () => this.goToSlide(index));
      });
      
      this.carousel.addEventListener('mouseenter', () => this.stopAutoSlide());
      this.carousel.addEventListener('mouseleave', () => this.startAutoSlide());
    }
    
    updateSlides() {
      this.slides.forEach((slide, index) => {
        slide.classList.toggle('active', index === this.currentSlide);
      });
      
      this.indicators.forEach((indicator, index) => {
        indicator.classList.toggle('active', index === this.currentSlide);
      });
    }
    
    nextSlide() {
      this.currentSlide = (this.currentSlide + 1) % this.slides.length;
      this.updateSlides();
    }
    
    prevSlide() {
      this.currentSlide = (this.currentSlide - 1 + this.slides.length) % this.slides.length;
      this.updateSlides();
    }
    
    goToSlide(index) {
      this.currentSlide = index;
      this.updateSlides();
    }
    
    startAutoSlide() {
      this.stopAutoSlide();
      this.slideInterval = setInterval(() => this.nextSlide(), 2000);
    }
    
    stopAutoSlide() {
      if (this.slideInterval) {
        clearInterval(this.slideInterval);
        this.slideInterval = null;
      }
    }
  }

  // Initialize carousel when DOM is loaded
  document.addEventListener('DOMContentLoaded', () => {
    new HeroCarousel();
  });

  // Re-initialize on Shopify section updates
  document.addEventListener('shopify:section:load', () => {
    new HeroCarousel();
  });
</script>

{% schema %}
{
  "name": "Hero Carousel",
  "tag": "section",
  "class": "section",
  "settings": [
    {
      "type": "header",
      "content": "t:sections.all.padding.section_padding_heading"
    },
    {
      "type": "range",
      "id": "padding_top",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_top",
      "default": 0
    },
    {
      "type": "range",
      "id": "padding_bottom",
      "min": 0,
      "max": 100,
      "step": 4,
      "unit": "px",
      "label": "t:sections.all.padding.padding_bottom",
      "default": 0
    }
  ],
  "blocks": [
    {
      "type": "slide",
      "name": "Slide",
      "limit": 3,
      "settings": [
        {
          "type": "image_picker",
          "id": "image",
          "label": "Image"
        },
        {
          "type": "text",
          "id": "heading",
          "default": "Hero heading",
          "label": "Heading"
        },
        {
          "type": "richtext",
          "id": "text",
          "default": "<p>Add a description for this slide</p>",
          "label": "Text"
        },
        {
          "type": "text",
          "id": "button_label",
          "default": "Button label",
          "label": "Button label"
        },
        {
          "type": "url",
          "id": "button_link",
          "label": "Button link"
        },
        {
          "type": "select",
          "id": "content_position",
          "options": [
            {
              "value": "center",
              "label": "Center"
            },
            {
              "value": "left",
              "label": "Left"
            },
            {
              "value": "right",
              "label": "Right"
            }
          ],
          "default": "center",
          "label": "Content position"
        }
      ]
    }
  ],
  "presets": [
    {
      "name": "Hero Carousel",
      "blocks": [
        {
          "type": "slide"
        },
        {
          "type": "slide"
        },
        {
          "type": "slide"
        }
      ]
    }
  ]
}
{% endschema %} 